= Create new LRA programmatic client API
:author:            Marco Sappe' Griot
:email:             msappegr@redhat.com
:toc:               left
:icons:             font
:idprefix:
:idseparator:       -

== Requirements

Create a new full REST client for the LRA Coordinator. The new client must contain methods corresponding to all of the LRA coordinator endpoints. The current client is NarayanaLRAClient which was deprecated and later moved to an internal package. The new client should replace NarayanaLRAClient by implementing its functionality. 
NarayanaLRAClient uses the stork library to handle multiple Coordinators (a cluster of Coordinator). The new implementation must have that functionality too.
Unit tests and integration tests are required.
The new client must implement the MicroProfile REST Client specification:  https://microprofile.io/specifications/microprofile-rest-client/ .  

=== Hard Requirements

- New Programmatic LRA client using the MicroProfile REST Client implementation
- All LRA Coordinator endpoints should be accessible with the new programmatic API
- The new client must be able to deal with multiple coordinators using the stork library
- Unit test to be included
- Integration test to be included

=== Nice-to-Have Requirements

- Address https://github.com/jbosstm/lra/issues/157 too (Decide whether we should make the internal LRA client API not auto closable). My personal opinion is that we would benefit from having the client auto-closable.

== Implementation Details

=== Client Interface Design

The new client will expose the following main operations:

- `startLRA()` - Start a new LRA transaction
- `joinLRA()` - Join an existing LRA
- `leaveLRA()` - Leave an LRA without compensating
- `closeLRA()` - Close/complete an LRA
- `cancelLRA()` - Cancel an LRA (trigger compensation)
- `getLRAStatus()` - Get the current status of an LRA
- `getAllLRAs()` - List all active LRAs

=== MicroProfile REST Client Integration

The implementation will use MicroProfile REST Client annotations:

- `@RegisterRestClient` for client registration
- `@Path` for endpoint mapping
- `@POST`, `@PUT`, `@GET`, `@DELETE` for HTTP methods
- `@HeaderParam`, `@QueryParam` for parameter binding
- `@Produces`/`@Consumes` for content negotiation

=== Stork Integration for Load Balancing

- Stork integration is already included in the NarayanaLRAClient and will be available in the new client too.

=== Migration Path

NarayanaLRAClient is internal and the new client will be public.
However I will provide a migration guidance from NarayanaLRAClient:
- API mapping documentation
- Code examples showing before/after usage
- I will update the codebase to replace the usage of NarayanaLRAClient with the new client.